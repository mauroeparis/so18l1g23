#include "types.h"
#include "param.h"
#include "memlayout.h"
#include "mmu.h"
#include "proc.h"
#include "defs.h"
#include "x86.h"
#include "elf.h"

#define DIR       0xB8000
#define COLOR     (0x5F << 8) // Color: 5 Pink, F White

void
vgainit(void)
{
  uchar SO2018[] = "Aguante SO2018!";
  int len = sizeof(SO2018);

  ushort *VGAs = (ushort *) DIR;
  int offset;
  int y = 24; // Footer
  int x;

  for (x = 0; x < len; x++)
  {
    offset = (80 * y) + x;
    VGAs[offset] = (ushort) (COLOR + SO2018[x]);
  }
}

void
mode_13H (void)
{
  /* MISC 0x3C2 */
  outb(0x3C2, 0x63);

  /* SEQ 0x3C4 - 0x3C5 */
  outb(0x3C4, 0);
  outb(0x3C5, 0x03);
  outb(0x3C4, 1);
  outb(0x3C5, 0x01);
  outb(0x3C4, 2);
  outb(0x3C5, 0x0F);
  outb(0x3C4, 3);
  outb(0x3C5, 0x00);
  outb(0x3C4, 4);
  outb(0x3C5, 0x0E);

  /* CRTC 0x3D4 - 0x3D5*/
  outb(0x3D4, 0);
  outb(0x3D5, 0x5F);
  outb(0x3D4, 1);
  outb(0x3D5, 0x4F);
  outb(0x3D4, 2);
  outb(0x3D5, 0x50);
  outb(0x3D4, 3);
  outb(0x3D5, 0x82);
  outb(0x3D4, 4);
  outb(0x3D5, 0x54);
  outb(0x3D4, 5);
  outb(0x3D5, 0x80);
  outb(0x3D4, 6);
  outb(0x3D5, 0xBF);
  outb(0x3D4, 7);
  outb(0x3D5, 0x1F);
  outb(0x3D4, 8);
  outb(0x3D5, 0x00);
  outb(0x3D4, 9);
  outb(0x3D5, 0x41);
  outb(0x3D4, 10);
  outb(0x3D5, 0x00);
  outb(0x3D4, 11);
  outb(0x3D5, 0x00);
  outb(0x3D4, 12);
  outb(0x3D5, 0x00);
  outb(0x3D4, 13);
  outb(0x3D5, 0x00);
  outb(0x3D4, 14);
  outb(0x3D5, 0x00);
  outb(0x3D4, 15);
  outb(0x3D5, 0x00);
  outb(0x3D4, 16);
  outb(0x3D5, 0x9C);
  outb(0x3D4, 17);
  outb(0x3D5, 0x0E);
  outb(0x3D4, 18);
  outb(0x3D5, 0x8F);
  outb(0x3D4, 19);
  outb(0x3D5, 0x28);
  outb(0x3D4, 20);
  outb(0x3D5, 0x40);
  outb(0x3D4, 21);
  outb(0x3D5, 0x96);
  outb(0x3D4, 22);
  outb(0x3D5, 0xB9);
  outb(0x3D4, 23);
  outb(0x3D5, 0xA3);
  outb(0x3D4, 24);
  outb(0x3D5, 0xFF);

  /* GC 0x3CE - 0x3CF*/
  outb(0x3CE, 0);
  outb(0x3CF, 0x00);
  outb(0x3CE, 1);
  outb(0x3CF, 0x00);
  outb(0x3CE, 2);
  outb(0x3CF, 0x00);
  outb(0x3CE, 3);
  outb(0x3CF, 0x00);
  outb(0x3CE, 4);
  outb(0x3CF, 0x00);
  outb(0x3CE, 5);
  outb(0x3CF, 0x40);
  outb(0x3CE, 6);
  outb(0x3CF, 0x05);
  outb(0x3CE, 7);
  outb(0x3CF, 0x0F);
  outb(0x3CE, 8);
  outb(0x3CF, 0xFF);

  /* AC 0x3C0 */
  outb(0x3C0, 0);
  outb(0x3C0, 0x00);
  outb(0x3C0, 1);
  outb(0x3C0, 0x01);
  outb(0x3C0, 2);
  outb(0x3C0, 0x02);
  outb(0x3C0, 3);
  outb(0x3C0, 0x03);
  outb(0x3C0, 4);
  outb(0x3C0, 0x04);
  outb(0x3C0, 5);
  outb(0x3C0, 0x05);
  outb(0x3C0, 6);
  outb(0x3C0, 0x06);
  outb(0x3C0, 7);
  outb(0x3C0, 0x07);
  outb(0x3C0, 8);
  outb(0x3C0, 0x08);
  outb(0x3C0, 9);
  outb(0x3C0, 0x09);
  outb(0x3C0, 10);
  outb(0x3C0, 0x0A);
  outb(0x3C0, 11);
  outb(0x3C0, 0x0B);
  outb(0x3C0, 12);
  outb(0x3C0, 0x0C);
  outb(0x3C0, 13);
  outb(0x3C0, 0x0D);
  outb(0x3C0, 14);
  outb(0x3C0, 0x0E);
  outb(0x3C0, 15);
  outb(0x3C0, 0x0F);
  outb(0x3C0, 16);
  outb(0x3C0, 0x41);
  outb(0x3C0, 17);
  outb(0x3C0, 0x00);
  outb(0x3C0, 18);
  outb(0x3C0, 0x0F);
  outb(0x3C0, 19);
  outb(0x3C0, 0x00);
  outb(0x3C0, 20);
  outb(0x3C0, 0x00);

  // Enable screen
  inb(0x3DA);
  outb(0x3C0, 0x20);

  uchar *VGAs = P2V((uchar *) 0xA0000);
  int i, j;
  for (j = 0; j < 320; j++) {
    for(i = 0; i < 200; i++) {
      VGAs[j + 320*i] = 0x0D;
    }
  }
}

void
mode_3H(void)
{

}
